# プロジェクト要求仕様

本ファイルに記載された内容を「プロジェクト要求仕様」と定義します。
例えば、『プロジェクト要求仕様の通りに実装する』とは、本ファイルの仕様を実装することを指します。

## プロジェクト名

ログ送信アプリケーション

## プロジェクトの機能

- ログファイルを生成、更新し、Azure IoTHubのファイルアップロード機能（<https://learn.microsoft.com/ja-jp/azure/iot-hub/iot-hub-devguide-file-upload#file-upload-overview> ）を使用してファイルをAzure Blob Storageへアップロードします
- アプリケーション（GUI）にはボタンが一つ存在し、押下するとアプリケーションと同じディレクトリにyyyy-MM-dd.logというファイルにログを一つ書き込みます
- ログファイルが存在しない場合は作成します
- ×ボタンを押下するとアプリケーションが終了します
- ログはタイムスタンプとイベント（START, STOP, WARN, ERRORのいずれか)とコメント（ランダムなメッセージ）がJSON Lines形式で出力されます
- タイムスタンプはISO 8601形式で、JSTで出力されます
- ログファイルはアプリケーションのボタンを押下することで、生成、または更新（Append）されます。
- Azure IoTHubのファイルアップロード機能を使用してAzure Blob Storageにアップロードされます。
- ログが書き込まれた直後にアップロードを試行します
- アップロードに失敗した場合はリトライ動作を行いません
- アプリケーション起動時に特別な処理（初期ログの出力など）はありません
- アップロード失敗時に特別なイベント（エラーログの出力やユーザーへの通知など）は発生しません
- 日付が変わった場合は、新しくログファイルを作成します
- アプリケーションの利用者は一般ユーザー
- ログのイベントタイプ（START, STOP, WARN, ERROR）はランダムに選択される
- アップロード成功/失敗時にはそれぞれ成功/失敗のダイアログを表示する
- ボタンを押したときの流れは「ボタンを押す → ログを書き込む → アップロードする」の順

## 補足事項

- ログファイル名 (`yyyy-MM-dd.log`) は JST (日本標準時) を基準とする
- アップロード失敗時は、失敗ダイアログを表示するのみで、他のエラー処理（ログ出力など）は行わない
- 日付が変わる判定は、ボタン押下時に行われる。アプリケーション実行中に日付が変わった場合、次のボタン押下時に新しい日付のログファイルが作成される
- アプリケーションはAzure IoT Hubのデバイスとして動作し、認証情報（デバイスIDや接続文字列など）が必要
- アップロード先のBlob Storageパスは事前に設定されたコンテナに、デバイス名のディレクトリが作成され、そこに格納される
- アプリケーションはWPFで作成される
- アップロード中はUIをブロッキングする
- アップロードのタイムアウトはプログラムのデフォルト設定に従う（最大5秒目安）
- 成功/失敗ダイアログには「成功」「失敗」と表示し、「OK」ボタンを設ける
- ログのランダムメッセージはイベント種別ごとに2種類用意し、ランダムに選択する
- IoT Hub接続断時は、ログアップロード時に再接続を試行し、失敗したらアップロード失敗扱いとする
- 認証情報は `appsettings.json` に埋め込む
