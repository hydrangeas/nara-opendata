# タスク間依存関係

本ドキュメントでは、各タスク間の依存関係をガントチャート形式で可視化します。タスクは機能領域ごとにグループ化され、並行実行可能な作業と順次実行が必要な作業を明確に示しています。

```mermaid
gantt
    title プロジェクトタスクの依存関係
    dateFormat YYYY-MM-DD
    
    section 基盤構築
        開発環境構築 :t0001, 2025-01-01, 1d
        Supabase環境構築 :t0002, after t0001, 1d
        DBスキーマ設計 :t0034, 2025-01-01, 1.5d
        共通型定義 :t0035, after t0001 t0002, 1d
        DIコンテナ設定 :t0038, after t0001, 1d
    
    section ドメイン層
        認証ドメイン実装 :t0003, after t0001, 1d
        APIドメイン実装 :t0004, after t0001 t0003, 1d
        データドメイン実装 :t0005, after t0001, 0.5d
        ログドメイン実装 :t0006, after t0001, 1d
        イベント・エラー処理 :t0007, after t0001, 1d
        パストラバーサル対策 :t0039, after t0005 t0007, 1d
        ResourceFactory実装 :t0043, after t0006, 0.5d
    
    section インフラ層
        Supabase Auth統合 :t0008, after t0002 t0003, 1d
        レート制限リポジトリ :t0009, after t0002 t0004, 1.5d
        基本ログリポジトリ :t0010, after t0002 t0006, 1d
        ファイルリポジトリ :t0011, after t0005, 0.5d
        イベントバス実装 :t0012, after t0007, 0.5d
        Custom Token Hook :t0040, after t0034, 0.5d
        APIEndpointRepo :t0041, after t0004 t0009, 1d
        高度ログ分析機能 :t0042, after t0010 t0034, 2d
    
    section アプリケーション層
        認証ユースケース :t0013, after t0003 t0007 t0008 t0012, 1d
        APIユースケース :t0014, after t0004 t0007 t0009 t0012 t0013, 1d
        データユースケース :t0015, after t0005 t0007 t0011 t0012, 0.5d
        ログユースケース :t0016, after t0006 t0007 t0010 t0012, 1d
        イベントハンドラー :t0044, after t0012, 2d
        ログ分析サービス :t0045, after t0042, 1d
    
    section API基盤
        Fastifyサーバー構築 :t0017, after t0001, 1d
        認証ミドルウェア :t0018, after t0013 t0017, 0.5d
        レート制限MW :t0019, after t0014 t0017 t0018, 1d
        CORS・セキュリティ :t0020, after t0017, 0.5d
        エラーハンドラー :t0036, after t0007 t0035, 1d
        ヘルスチェック :t0037, after t0002, 0.5d
    
    section APIエンドポイント
        認証エンドポイント :t0021, after t0013 t0017 t0018, 1d
        データエンドポイント :t0022, after t0014 t0015 t0017 t0018 t0019, 1d
    
    section フロントエンド
        ランディングページ :t0023, after t0001, 1d
        Auth UI統合 :t0024, after t0002 t0023, 1d
        ダッシュボード :t0025, after t0023 t0024, 0.5d
    
    section ドキュメント
        OpenAPI生成 :t0026, after t0017 t0021 t0022, 0.5d
        Scalarドキュメント :t0027, after t0026, 0.5d
    
    section デプロイ・運用
        Vercel設定 :t0028, after t0001 t0017 t0023, 0.5d
        CI/CD設定 :t0029, after t0001 t0028, 1d
        単体テスト環境 :t0030, after t0001, 0.5d
        統合テスト環境 :t0031, after t0017 t0030, 1d
        ログ監視基盤 :t0032, after t0016, 1d
        パフォーマンス最適化 :t0033, after t0022 t0028, 2d
```

## 依存関係の説明

### 基盤構築フェーズ
- **タスク0001**（開発環境構築）は全ての作業の前提条件
- **タスク0002**（Supabase環境）は認証・データベース関連の前提条件
- **タスク0034**（DBスキーマ設計）は最初に実行し、DB関連タスクの基盤となる
- **タスク0035**（共通型定義）は全パッケージで使用する型の基盤
- **タスク0038**（DIコンテナ設定）は依存性注入の基盤として早期に実装

### ドメイン層フェーズ
- ドメイン層の各コンテキスト（認証、API、データ、ログ）は並行開発可能
- **タスク0007**（イベント・エラー処理）は全ドメインで共通使用
- **タスク0039**（パストラバーサル対策）はセキュリティの重要実装
- **タスク0043**（ResourceFactory）はデータリソース生成の基盤

### インフラ層フェーズ
- 各リポジトリ実装は対応するドメイン層の完成が前提
- **タスク0009**（レート制限リポジトリ）と**タスク0010**（基本ログリポジトリ）は分離して実装
- **タスク0012**（イベントバス）はイベント処理基盤として必要
- **タスク0040**（Custom Token Hook）はJWTにtier情報を自動追加
- **タスク0041**（APIEndpointRepo）はエンドポイント設定管理
- **タスク0042**（高度ログ分析機能）は統計分析・異常検出を実装

### アプリケーション層フェーズ
- 各ユースケースは対応するドメイン層とインフラ層の完成が前提
- **タスク0014**（APIユースケース）は**タスク0013**（認証ユースケース）に依存
- イベントバスの完成も必須
- **タスク0044**（イベントハンドラー）は各種イベントの処理を実装
- **タスク0045**（ログ分析サービス）は不審なアクティビティを検出

### API実装フェーズ
- **タスク0017**（Fastifyサーバー）はAPI関連の基盤
- **タスク0036**（エラーハンドラー）はRFC 7807準拠の統一エラー処理を提供
- **タスク0037**（ヘルスチェック）は運用監視の基盤
- ミドルウェアは順次実装（認証→レート制限）
- エンドポイントは対応するユースケースの完成が前提

### フロントエンドフェーズ
- Webアプリケーションは独立して並行開発可能
- Auth UI統合はSupabase環境が前提

### 最終フェーズ
- ドキュメント生成はAPI実装完了後
- デプロイ設定は基本実装完了後
- テスト環境は早期に構築し、各実装と並行してテスト作成
- **タスク0032**（ログ監視基盤）は**タスク0016**（ログユースケース）完了後に実装