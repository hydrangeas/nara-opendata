# タスク間依存関係

プロジェクトのタスク間の依存関係を可視化し、効率的な実装順序を示します。依存関係は「前提タスクが完了しないと開始できない」強い依存を基本とし、並行実行可能なタスクも明示しています。

```mermaid
gantt
    title タスク実施スケジュール（依存関係）
    dateFormat YYYY-MM-DD

    section 基盤構築
        プロジェクト基盤セットアップ                    :0001, 2025-01-01, 3d
        Supabase設定                                   :0002, after 0001, 1d
        DB スキーマ作成                                :0003, after 0002, 1d
        Custom Access Token Hook                      :0004, after 0003, 1d
        環境変数管理                                   :0005, after 0001, 1d
        DIコンテナ設定                                 :0006, after 0001 0002, 1d
        ロギング基盤設定                               :0007, after 0001 0002 0005, 1d
        エラーハンドリング基盤                          :0008, after 0001 0002 0007, 1d

    section 認証コンテキスト
        認証Value Objects                             :0009, after 0001 0002 0008, 1d
        認証エンティティ                               :0010, after 0001 0002 0008 0009, 1d
        認証集約                                      :0011, after 0001 0002 0008 0009 0010, 1d
        認証リポジトリ                                 :0012, after 0001 0002 0003 0004 0006 0011, 1d

    section APIコンテキスト
        API Value Objects                             :0013, after 0001 0002 0008, 1d
        APIエンティティ                               :0014, after 0001 0002 0008 0013, 3d
        API集約                                      :0015, after 0001 0002 0008 0013 0014, 3d
        APIリポジトリ                                 :0016, after 0003 0006 0015, 1d

    section データコンテキスト
        データValue Objects                           :0017, after 0001 0002 0008, 1d
        データエンティティ                             :0018, after 0017, 1d
        データ集約                                    :0019, after 0018, 1d
        データリポジトリ                               :0020, after 0006 0019, 1d

    section ログコンテキスト
        ログValue Objects                             :0021, after 0001 0002 0008, 1d
        ログエンティティ                               :0022, after 0021, 1d
        ログ集約                                      :0023, after 0022, 1d
        ログリポジトリ                                 :0024, after 0003 0006 0023, 1d

    section イベント駆動
        イベントバス実装                               :0025, after 0006, 1d
        イベントハンドラー                             :0026, after 0025, 1d

    section アプリケーションサービス
        Vite開発環境構築                              :0027, after 0001, 1d
        APIアクセス制御サービス                         :0028, after 0016 0026, 3d
        データ取得サービス                             :0029, after 0020, 1d
        ログ記録サービス                               :0030, after 0024, 1d

    section ミドルウェア
        認証ミドルウェア                               :0031, after 0012, 1d
        レート制限ミドルウェア                          :0032, after 0028, 1d
        CORS/セキュリティヘッダー                       :0033, after 0001 0002 0005, 1d
        パス検証ミドルウェア                           :0034, after 0008, 1d

    section APIエンドポイント
        OpenAPI設定                                   :0035, after 0001, 1d
        認証エンドポイント                             :0036, after 0012 0031, 3d
        データAPIエンドポイント                         :0037, after 0028 0029 0032, 3d
        ヘルスチェック                                :0038, after 0001, 1d
        APIドキュメント                               :0039, after 0035, 1d

    section フロントエンド
        DBマイグレーション                             :0040, after 0003, 1d
        Supabase Auth UI                             :0041, after 0002 0027, 1d
        トップページ                                  :0042, after 0027 0041, 1d
        ダッシュボード                                :0043, after 0027 0041, 1d
        認証状態管理                                  :0044, after 0027 0041, 1d
        APIクライアント                               :0045, after 0027, 1d
        エラーハンドリングUI                           :0046, after 0027, 1d
        UIコンポーネント                              :0047, after 0027, 1d
        ルーティング                                  :0048, after 0027 0042 0043, 1d
        ビルド最適化                                  :0049, after 0027, 1d
```

## 主要な依存関係パターン

### 1. 基盤 → ドメイン → アプリケーション → プレゼンテーション

- 基盤構築（0001-0008）が最優先
- 各コンテキストのドメインモデル（0009-0024）が次
- アプリケーションサービス（0027-0030）がドメインモデル完了後
- エンドポイント実装（0036-0039）が最後

### 2. 並行実行可能なタスク群

- 各コンテキストのドメインモデル実装は並行可能
- フロントエンド開発はバックエンドと並行可能
- テスト実装は対象機能の完了後すぐに開始可能

### 3. クリティカルパス

1. プロジェクト基盤セットアップ（0001）
2. Supabase設定（0002）
3. 認証コンテキスト実装（0009-0012）
4. 認証ミドルウェア（0031）
5. 認証エンドポイント（0036）

### 4. ボトルネックとなりやすいタスク

- Custom Access Token Hook（0004）：多くのタスクが依存
- DIコンテナ設定（0006）：リポジトリ実装の前提
- イベントバス実装（0025）：サービス層の前提

## 実装の推奨順序

### フェーズ1：基盤構築（約1週間）

- タスク0001-0008を順次実施
- 環境構築とコア機能の確立

### フェーズ2：ドメインモデル実装（約2週間）

- 認証コンテキスト（0009-0012）を優先
- API、データ、ログコンテキストは並行実施可能

### フェーズ3：アプリケーション層実装（約1週間）

- イベントバス（0025-0026）を先行
- 各サービス（0027-0030）を実装

### フェーズ4：プレゼンテーション層実装（約1週間）

- ミドルウェア（0031-0034）
- エンドポイント（0036-0039）
- フロントエンド（0040-0049）は並行可能

### フェーズ5：テストとデプロイ（約1週間）

- 各種テスト（0050-0058）
- CI/CD設定（0059-0062）
- ドキュメント整備（0063-0066）
