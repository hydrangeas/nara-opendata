# 実装計画

依存関係とリスクを考慮し、効率的な開発を実現するための実装順序を定義します。並行作業を最大化しつつ、ブロッキング要因を最小化する計画です。

|実装順|タスク番号|説明|優先度|見積もり工数|要事前完了タスク|
|-|-|-|-|-|-|
|1|0034|Supabaseデータベーススキーマ設計とマイグレーション|高|3(約1.5日)|-|
|2|0040|Custom Access Token Hook実装|高|2(約0.5日)|0034|
|3|0001|開発環境構築とプロジェクト初期設定|高|3(約1日)|-|
|4|0002|Supabase環境構築と基本設定|高|3(約1日)|0001|
|5|0038|DIコンテナ設定とサービス登録|高|3(約1日)|0001|
|6|0035|TypeScript共通型定義とパッケージ間依存設定|高|2(約1日)|0001,0002|
|7|0030|単体テスト環境の構築|中|2(約0.5日)|0001|
|8|0037|ヘルスチェック・メトリクスエンドポイント実装|中|1(約0.5日)|0002|
|9|0003|ドメイン層の基本実装（認証コンテキスト）|高|3(約1日)|0001|
|10|0005|ドメイン層の基本実装（データコンテキスト）|高|2(約0.5日)|0001|
|11|0006|ドメイン層の基本実装（ログコンテキスト）|中|3(約1日)|0001|
|12|0007|ドメインイベントとエラー処理の実装|高|3(約1日)|0001|
|13|0017|Fastify APIサーバーの基本構築|高|3(約1日)|0001|
|14|0023|ランディングページの実装（フロントエンド）|中|3(約1日)|0001|
|15|0036|グローバルエラーハンドラーとRFC 7807実装|高|2(約1日)|0007,0035|
|16|0043|OpenDataResourceFactory実装|中|2(約0.5日)|0006|
|17|0004|ドメイン層の基本実装（APIコンテキスト）|高|3(約1日)|0001,0003|
|18|0008|Supabase Auth統合の実装（インフラ層）|高|3(約1日)|0002,0003|
|19|0011|OpenDataRepositoryの実装（ファイルシステム）|高|2(約0.5日)|0005|
|20|0039|パストラバーサル攻撃対策実装|高|3(約1日)|0005,0007|
|21|0012|イベントバスの実装|中|2(約0.5日)|0007|
|22|0044|イベントハンドラー実装|中|5(約2日)|0012|
|23|0020|CORS設定とセキュリティヘッダーの実装|高|2(約0.5日)|0017|
|24|0024|Supabase Auth UIの統合|高|3(約1日)|0002,0023|
|25|0009|レート制限リポジトリ実装|高|3(約1.5日)|0002,0004|
|26|0041|APIEndpointRepository実装|中|3(約1日)|0004,0009|
|27|0010|基本ログリポジトリ実装|高|2(約1日)|0002,0006|
|28|0042|高度なログ分析機能実装|中|5(約2日)|0010,0034|
|29|0045|LogAnalysisService実装|低|3(約1日)|0042|
|30|0013|認証ユースケースの実装（アプリケーション層）|高|3(約1日)|0003,0007,0008,0012|
|31|0031|統合テスト環境の構築|中|3(約1日)|0017,0030|
|32|0025|ダッシュボードページの実装|中|2(約0.5日)|0023,0024|
|33|0014|APIアクセスユースケースの実装（アプリケーション層）|高|3(約1日)|0004,0007,0009,0012,0013|
|34|0015|データ取得ユースケースの実装（アプリケーション層）|高|2(約0.5日)|0005,0007,0011,0012|
|35|0016|ログ記録ユースケースの実装（アプリケーション層）|中|3(約1日)|0006,0007,0010,0012|
|36|0018|認証ミドルウェアの実装|高|2(約0.5日)|0013,0017|
|37|0028|Vercelデプロイ設定|高|2(約0.5日)|0001,0017,0023|
|38|0021|認証関連APIエンドポイントの実装|高|3(約1日)|0013,0017,0018|
|39|0019|レート制限ミドルウェアの実装|高|3(約1日)|0014,0017,0018|
|40|0022|データ提供APIエンドポイントの実装|高|3(約1日)|0014,0015,0017,0018,0019|
|41|0032|エラー監視とロギング基盤の実装|中|3(約1日)|0016|
|42|0029|GitHub Actions CI/CD設定|中|3(約1日)|0001,0028|
|43|0026|OpenAPI仕様書生成スクリプトの実装|中|2(約0.5日)|0017,0021,0022|
|44|0027|Scalar APIドキュメントの静的生成|中|2(約0.5日)|0026|
|45|0033|パフォーマンス最適化とキャッシュ戦略|低|5(約2日)|0022,0028|

## 実装フェーズの説明

### フェーズ1: 基盤構築（1-16）
- DBスキーマ設計とCustom Token Hookを最優先で実施
- 開発環境とDIコンテナを整備
- 共通型定義とエラーハンドラーを早期に実装
- ドメイン層の基本実装を並行して進行
- APIサーバーとフロントエンドの基盤を並行構築
- セキュリティ対策（パストラバーサル）を早期に実装

### フェーズ2: コア機能実装（17-35）
- 認証とデータアクセスの基本機能を実装
- イベント駆動アーキテクチャを構築（EventBus、EventHandlers）
- インフラ層をレート制限とログに分割して実装
- APIEndpointRepositoryで動的な権限管理を実現
- 基本ログリポジトリと高度な分析機能を段階的に実装
- アプリケーション層を順次構築
- フロントエンドの認証統合を並行実施

### フェーズ3: API完成（36-41）
- APIエンドポイントとミドルウェアを実装
- レート制限とセキュリティ機能を追加
- デプロイ設定を並行して準備
- ログ監視基盤を整備

### フェーズ4: 仕上げ（42-45）
- CI/CD環境を整備
- APIドキュメントを生成
- ログ分析サービスでセキュリティ監視を強化
- パフォーマンス最適化を実施

## リスク軽減策

1. **Supabase設定の早期実施**: 外部依存を早期に解決
2. **セキュリティ機能の早期実装**: パストラバーサル対策とCustom Token Hookを優先
3. **DIコンテナの早期導入**: 依存性管理の基盤を最初に確立
4. **テスト環境の早期構築**: 各実装と並行してテスト作成可能
5. **並行開発の促進**: ドメイン層とフロントエンドは独立して開発
6. **インクリメンタルなデプロイ**: 基本機能完成時点でプレビューデプロイ可能